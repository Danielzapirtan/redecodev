<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Designer CLI Web App</title>
    <style>
        body {
            font-family: monospace;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #cli-container {
            width: 800px;
            height: 400px;
            background-color: #000;
            color: #0f0;
            padding: 10px;
            overflow-y: scroll;
            border: 1px solid #333;
            margin-bottom: 20px;
        }
        #cli-output {
            white-space: pre-wrap;
        }
        #cli-input {
            width: 100%;
            background: transparent;
            border: none;
            color: #0f0;
            font-family: monospace;
            outline: none;
        }
        #canvas-container {
            border: 1px solid #333;
            margin-bottom: 20px;
        }
        #prompt-output {
            width: 800px;
            height: 200px;
            background-color: #fff;
            border: 1px solid #333;
            padding: 10px;
            overflow-y: scroll;
            white-space: pre-wrap;
        }
        canvas {
            background-color: #fff;
        }
    </style>
</head>
<body>
    <h1>Room Designer CLI</h1>
    <p>Type commands in the CLI below. Use 'help' for command list.</p>
    <div id="cli-container">
        <div id="cli-output"></div>
        <span>$ </span><input type="text" id="cli-input" autofocus>
    </div>
    <div id="canvas-container">
        <canvas id="room-canvas" width="600" height="400"></canvas>
    </div>
    <div id="prompt-output">Generated prompt will appear here...</div>

    <script>
        // Room model
        let room = {
            width: 600,
            height: 400,
            furniture: [] // {id: number, type: string, x: number, y: number, width: number, height: number, rotation: number}
        };
        let nextId = 1;

        // Predefined furniture sizes (in pixels, assuming canvas scale)
        const furnitureTypes = {
            chair: {width: 50, height: 50},
            table: {width: 100, height: 60},
            bed: {width: 150, height: 200},
            sofa: {width: 150, height: 80},
            lamp: {width: 30, height: 30},
            shelf: {width: 100, height: 30}
            // Add more as needed
        };

        // CLI elements
        const cliOutput = document.getElementById('cli-output');
        const cliInput = document.getElementById('cli-input');
        const canvas = document.getElementById('room-canvas');
        const ctx = canvas.getContext('2d');
        const promptOutput = document.getElementById('prompt-output');

        // Draw the room and furniture
        function drawRoom() {
            ctx.clearRect(0, 0, room.width, room.height);
            // Draw room boundaries
            ctx.strokeRect(0, 0, room.width, room.height);

            // Draw furniture
            room.furniture.forEach(item => {
                ctx.save();
                ctx.translate(item.x + item.width / 2, item.y + item.height / 2);
                ctx.rotate(item.rotation * Math.PI / 180);
                ctx.fillStyle = '#888';
                ctx.fillRect(-item.width / 2, -item.height / 2, item.width, item.height);
                ctx.fillStyle = '#000';
                ctx.font = '12px monospace';
                ctx.fillText(item.type, -item.width / 2 + 5, 0);
                ctx.restore();
            });
        }

        // Generate Gemini prompt
        function generatePrompt(view = 'front') {
            let desc = `A realistic, non-interactive 3D view of a room interior from a \( {view} perspective. The room dimensions are \){room.width / 10}m wide by ${room.height / 10}m deep. Furniture placements:`;
            room.furniture.forEach(item => {
                desc += `\n- A \( {item.type} at position ( \){item.x / 10}m, \( {item.y / 10}m), rotated \){item.rotation} degrees, size \( {item.width / 10}m x \){item.height / 10}m.`;
            });
            desc += '\nRender in high detail, photorealistic style, with natural lighting.';
            return desc;
        }

        // Log to CLI
        function log(message) {
            cliOutput.innerHTML += message + '\n';
            cliOutput.scrollTop = cliOutput.scrollHeight;
        }

        // Handle commands
        function handleCommand(cmd) {
            const parts = cmd.trim().split(/\s+/);
            const action = parts[0].toLowerCase();

            switch (action) {
                case 'help':
                    log(`Commands:
- set room <width> <height> : Set room dimensions (pixels)
- add <type> <x> <y> [<width> <height> <rotation>] : Add furniture (types: ${Object.keys(furnitureTypes).join(', ')})
- move <id> <x> <y> : Move furniture by ID
- rotate <id> <degrees> : Rotate furniture
- resize <id> <width> <height> : Resize furniture
- remove <id> : Remove furniture
- list : List all furniture
- clear : Clear all furniture
- generate [<view>] : Generate Gemini prompt (view: front, top, side, etc.)
- help : Show this help`);
                    break;

                case 'set':
                    if (parts[1] === 'room' && parts.length === 4) {
                        room.width = parseInt(parts[2]);
                        room.height = parseInt(parts[3]);
                        canvas.width = room.width;
                        canvas.height = room.height;
                        drawRoom();
                        log('Room dimensions set.');
                    } else {
                        log('Invalid set command.');
                    }
                    break;

                case 'add':
                    if (parts.length >= 4) {
                        const type = parts[1].toLowerCase();
                        if (!furnitureTypes[type]) {
                            log('Unknown furniture type.');
                            break;
                        }
                        const x = parseInt(parts[2]);
                        const y = parseInt(parts[3]);
                        const w = parts[4] ? parseInt(parts[4]) : furnitureTypes[type].width;
                        const h = parts[5] ? parseInt(parts[5]) : furnitureTypes[type].height;
                        const rot = parts[6] ? parseInt(parts[6]) : 0;
                        room.furniture.push({id: nextId++, type, x, y, width: w, height: h, rotation: rot});
                        drawRoom();
                        log(`Added \( {type} with ID \){nextId - 1}.`);
                    } else {
                        log('Invalid add command.');
                    }
                    break;

                case 'move':
                    if (parts.length === 4) {
                        const id = parseInt(parts[1]);
                        const item = room.furniture.find(i => i.id === id);
                        if (item) {
                            item.x = parseInt(parts[2]);
                            item.y = parseInt(parts[3]);
                            drawRoom();
                            log(`Moved ID ${id}.`);
                        } else {
                            log('Item not found.');
                        }
                    } else {
                        log('Invalid move command.');
                    }
                    break;

                case 'rotate':
                    if (parts.length === 3) {
                        const id = parseInt(parts[1]);
                        const item = room.furniture.find(i => i.id === id);
                        if (item) {
                            item.rotation = parseInt(parts[2]);
                            drawRoom();
                            log(`Rotated ID ${id}.`);
                        } else {
                            log('Item not found.');
                        }
                    } else {
                        log('Invalid rotate command.');
                    }
                    break;

                case 'resize':
                    if (parts.length === 4) {
                        const id = parseInt(parts[1]);
                        const item = room.furniture.find(i => i.id === id);
                        if (item) {
                            item.width = parseInt(parts[2]);
                            item.height = parseInt(parts[3]);
                            drawRoom();
                            log(`Resized ID ${id}.`);
                        } else {
                            log('Item not found.');
                        }
                    } else {
                        log('Invalid resize command.');
                    }
                    break;

                case 'remove':
                    if (parts.length === 2) {
                        const id = parseInt(parts[1]);
                        room.furniture = room.furniture.filter(i => i.id !== id);
                        drawRoom();
                        log(`Removed ID ${id}.`);
                    } else {
                        log('Invalid remove command.');
                    }
                    break;

                case 'list':
                    let listStr = 'Furniture list:\n';
                    room.furniture.forEach(item => {
                        listStr += `ID \( {item.id}: \){item.type} at (\( {item.x}, \){item.y}), size \( {item.width}x \){item.height}, rot ${item.rotation}\n`;
                    });
                    log(listStr);
                    break;

                case 'clear':
                    room.furniture = [];
                    nextId = 1;
                    drawRoom();
                    log('Cleared all furniture.');
                    break;

                case 'generate':
                    const view = parts[1] || 'front';
                    const prompt = generatePrompt(view);
                    promptOutput.innerText = prompt;
                    log('Generated prompt (copied to output area).');
                    break;

                default:
                    log('Unknown command. Type "help" for list.');
            }
        }

        // Event listener for input
        cliInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const cmd = cliInput.value.trim();
                if (cmd) {
                    log('$ ' + cmd);
                    handleCommand(cmd);
                }
                cliInput.value = '';
            }
        });

        // Initial draw
        drawRoom();
        log('Welcome to Room Designer CLI. Type "help" for commands.');
    </script>
</body>
</html>